<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>卡提希娅的星光小站</title>

  <!-- Favicon 缓存破坏 -->
  <link rel="icon" href="favicon/13.ico?v=20240626" type="image/x-icon">
  <link rel="shortcut icon" href="favicon/13.ico?v=20240626" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/16.png?v=20240626">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/1.png?v=20240626">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  
  <!-- ================= 完整整合的CSS ================= -->
  <style>
/* 全局样式重置样式以及 强制文字颜色（方便解决浅色模式不可见） */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "楷体", "PingFang SC", "Microsoft YaHei", sans-serif;
    scroll-behavior: smooth;
    color: #333333 !important; /* 强制浅色模式文字颜色，最高优先级 */
}

:root {
    /* 主题配色（银紫色/冰蓝色）- 保留原有预设 */
    --primary-color-purple: #9c7ee6;
    --secondary-color-purple: #b8a3f5;
    --bg-color-purple: rgba(156, 126, 230, 0.05);
    --card-bg-purple: #ffffff;
    --shadow-purple: 0 8px 32px rgba(156, 126, 230, 0.2);

    --primary-color-blue: #6ec6ff;
    --secondary-color-blue: #99d1ff;
    --bg-color-blue: rgba(110, 198, 255, 0.05);
    --card-bg-blue: #ffffff;
    --shadow-blue: 0 8px 32px rgba(110, 198, 255, 0.2);

    /* 默认主题变量（支持自定义调色覆盖） */
    --primary-color: var(--primary-color-purple);
    --secondary-color: var(--secondary-color-purple);
    --bg-color: var(--bg-color-purple);
    --card-bg: var(--card-bg-purple);
    --card-shadow: var(--shadow-purple);
    --card-shadow-hover: 0 12px 40px rgba(156, 126, 230, 0.3);

    /* 新增：自定义调色专用变量（用于自动生成深浅色） */
    --primary-dark: #8062d6;
    --primary-lightest: rgba(156, 126, 230, 0.05);

    --white-color: #fff;
    --transition: all 0.3s ease-in-out;
    --border-radius: 12px;
}

/* 深色模式单独配置（文字强制白色） */
.dark-mode {
    --card-bg: #2d2d2d;
    --shadow-purple: 0 8px 32px rgba(0, 0, 0, 0.3);
    --shadow-blue: 0 8px 32px rgba(0, 0, 0, 0.3);
    --card-shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
    --bg-color: #1a1a1a;
    background-color: #1a1a1a;
}
/* 深色模式文字强制白色 */
.dark-mode * {
    color: #f5f5f5 !important;
}

/* 打字机效果 */
.typewriter {
    overflow: hidden;
    border-right: 2px solid var(--primary-color) !important;
    white-space: nowrap;
    margin: 0 auto;
    letter-spacing: 0.1em;
    animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
}
@keyframes typing { from { width: 0 } to { width: 100% } }
@keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: var(--primary-color) } }

/* 隐藏类 */
.hidden { display: none !important; }
.modal-hidden { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }

/* 按钮样式（强制按钮文字白色） */
.btn {
    display: inline-block;
    padding: 12px 24px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: #fff !important; /* 按钮文字强制白色 */
    text-decoration: none;
    border-radius: var(--border-radius);
    border: none;
    cursor: pointer;
    transition: var(--transition);
    font-size: 14px;
    font-weight: 500;
    margin: 0 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}
.btn-secondary {
    background: transparent;
    color: var(--primary-color) !important;
    border: 2px solid var(--primary-color);
    box-shadow: none;
}
.btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }

/* 导航栏 */
.navbar {
    position: fixed; top: 0; left: 0; width: 100%; z-index: 999;
    background: var(--card-bg); box-shadow: var(--card-shadow); transition: var(--transition);
}
.navbar.scrolled { padding: 10px 0; box-shadow: var(--card-shadow-hover); }
.nav-container { max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
.nav-logo { display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: bold; }
.nav-logo i { color: var(--primary-color) !important; }
.nav-menu { display: flex; list-style: none; gap: 30px; }
.nav-item .nav-link { text-decoration: none; font-size: 15px; font-weight: 500; transition: var(--transition); position: relative; }
.nav-item .nav-link:hover { color: var(--primary-color) !important; }
.nav-item .nav-link::after {
    content: ""; position: absolute; bottom: -5px; left: 0;
    width: 0; height: 2px; background-color: var(--primary-color); transition: var(--transition);
}
.nav-item .nav-link:hover::after { width: 100%; }

/* 控制面板（适配自定义调色器样式） */
.control-panel {
    position: fixed; top: 50%; right: 20px; transform: translateY(-50%);
    background: var(--card-bg); border-radius: var(--border-radius); box-shadow: var(--card-shadow);
    padding: 20px; z-index: 998; transition: var(--transition);
    min-width: 220px; /* 增加最小宽度，避免调色器挤在一起 */
}
.control-panel h3 { font-size: 16px; margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; }
.control-panel h3 i { color: var(--primary-color) !important; }
.control-btn {
    display: block; width: 100%; padding: 12px 10px; margin-bottom: 15px;
    background: var(--bg-color); border: 1px solid var(--primary-color); border-radius: var(--border-radius);
    cursor: pointer; transition: var(--transition); font-size: 13px; text-align: center;
}
.control-btn:hover { background: var(--primary-color); color: #fff !important; }
/* 自定义调色区域样式优化 */
.control-panel .color-picker-wrap {
    margin: 10px 0; display: flex; align-items: center; gap: 8px;
    flex-wrap: wrap; justify-content: center;
}
.control-panel .color-picker-wrap label {
    color: var(--primary-color) !important; /* 标签用主题色 */
    font-size: 14px; white-space: nowrap;
}
.control-panel .color-picker-wrap input[type="color"] {
    width: 40px; height: 30px; border: none; cursor: pointer;
    border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.control-panel .color-picker-wrap .control-btn {
    padding: 8px 12px; margin-bottom: 0; font-size: 12px;
    width: auto; flex-shrink: 0;
}

/* 板块动效 */
.section-animate {
    opacity: 0; transform: translateY(50px); transition: opacity 0.8s ease, transform 0.8s ease;
    padding: 100px 20px; max-width: 1200px; margin: 0 auto;
}
.section-animate.visible { opacity: 1; transform: translateY(0); }
.section-header { text-align: center; margin-bottom: 40px; }
.section-header h2 { font-size: 26px; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 10px; }
.section-header h2 i { color: var(--primary-color) !important; }
.section-divider { width: 80px; height: 3px; background-color: var(--primary-color); margin: 0 auto; border-radius: 3px; }

/* 卡片样式 */
.card-animate {
    opacity: 0; transform: scale(0.95); transition: opacity 0.6s ease, transform 0.6s ease;
    background: var(--card-bg); border-radius: var(--border-radius); box-shadow: var(--card-shadow);
    padding: 30px; margin-bottom: 30px;
}
.card-animate.visible { opacity: 1; transform: scale(1); }
.card-animate:hover { box-shadow: var(--card-shadow-hover); transform: translateY(-5px); }

/* 首页样式 */
.home-section { height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg-color); padding: 0 20px; }
.home-container { text-align: center; }
.carterthyia-avatar {
    width: 180px; height: 180px; border-radius: 50%; object-fit: cover;
    border: 5px solid var(--primary-color); margin-bottom: 25px;
    box-shadow: var(--card-shadow); transition: var(--transition); cursor: pointer;
}
.carterthyia-avatar:hover { transform: scale(1.05) rotate(5deg); box-shadow: var(--card-shadow-hover); }
.character-title { font-size: 36px; margin-bottom: 15px; letter-spacing: 2px; }
.character-desc { font-size: 18px; margin-bottom: 35px; letter-spacing: 1px; color: #666 !important; }

/* 文字内容样式（强制区分主次文字） */
.about-info { font-size: 16px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 10px; }
.info-label { color: var(--primary-color) !important; font-weight: bold; }
.story-title { color: var(--primary-color) !important; font-size: 18px; margin-bottom: 15px; font-weight: 500; }
.story-paragraph, .guide-paragraph { font-size: 16px; line-height: 1.8; margin-bottom: 20px; }

/* 标签样式 */
.gallery-tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
.gallery-tab {
    padding: 10px 20px; background: var(--bg-color); border: 1px solid var(--primary-color);
    border-radius: var(--border-radius); cursor: pointer; transition: var(--transition);
}
.gallery-tab.active { background: var(--primary-color); color: #fff !important; }
.guide-tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
.tab-btn {
    padding: 10px 20px; background: var(--bg-color); border: 1px solid var(--primary-color);
    border-radius: var(--border-radius); cursor: pointer; transition: var(--transition);
}
.tab-btn.active { background: var(--primary-color); color: #fff !important; }

/* 图库横向排列 */
.gallery-container {
    display: flex; gap: 20px; padding: 10px 0; overflow-x: auto;
    scrollbar-width: thin; scrollbar-color: var(--primary-color) var(--bg-color);
    margin: 0 -10px; padding: 10px;
}
.gallery-container::-webkit-scrollbar { height: 8px; }
.gallery-container::-webkit-scrollbar-track { background: var(--bg-color); border-radius: 4px; }
.gallery-container::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 4px; }
.gallery-img {
    flex: 0 0 auto; width: 280px; height: 380px; object-fit: cover;
    border-radius: var(--border-radius); cursor: pointer; transition: var(--transition);
    box-shadow: var(--card-shadow);
}
.gallery-img:hover { transform: scale(1.03); box-shadow: var(--card-shadow-hover); }

/* 视频样式 */
.video-container {
    position: relative; border-radius: var(--border-radius); overflow: hidden;
    box-shadow: var(--card-shadow); margin: 0 auto; max-width: 800px;
}
.demo-video { width: 100%; aspect-ratio: 16/9; background: var(--bg-color); }
.video-cover {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(0deg, rgba(0, 0, 0, 0.7), transparent);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; z-index: 10;
}
.play-btn {
    width: 80px; height: 80px; border-radius: 50%; background: rgba(255, 255, 255, 0.3);
    display: flex; align-items: center; justify-content: center;
    font-size: 28px; color: #fff !important; transition: transform 0.3s ease;
}
.play-btn:hover { transform: scale(1.1); }

/* 图片预览弹窗 */
#imagePreviewModal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.9); z-index: 9999;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
#imagePreviewModal.show { opacity: 1; pointer-events: all; }
.preview-content { position: relative; max-width: 90%; max-height: 90%; }
#previewImage { width: 100%; height: auto; border-radius: var(--border-radius); box-shadow: var(--card-shadow-hover); }
.preview-close {
    position: absolute; top: -40px; right: 0; font-size: 30px;
    cursor: pointer; color: #fff !important; transition: var(--transition);
}
.preview-close:hover { color: var(--primary-color) !important; transform: rotate(90deg); }

/* 回到顶部 */
.back-to-top {
    position: fixed; bottom: 30px; right: 30px;
    background: var(--primary-color); color: #fff !important;
    width: 50px; height: 50px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: var(--card-shadow); transition: var(--transition);
    z-index: 997;
}
.back-to-top:hover { transform: translateY(-5px); box-shadow: var(--card-shadow-hover); }

/* ===== 优化新增样式 ===== */
/* 文字渐变效果 */
.text-gradient {
    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* 平滑过渡 */
.smooth-transition {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 卡片优化 */
.card-animate {
    transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
    transform-origin: center center;
}

/* 图片优化 */
.gallery-img {
    transition: transform 0.3s ease, opacity 0.3s ease;
    transform-origin: center center;
}

/* 按钮优化 */
.btn {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

.btn:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 0.5;
    }
    20% {
        transform: scale(25, 25);
        opacity: 0.3;
    }
    100% {
        transform: scale(40, 40);
        opacity: 0;
    }
}

/* 导航优化 */
.nav-link {
    position: relative;
    overflow: hidden;
}

.nav-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--primary-color);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
}

.nav-link:hover::after {
    transform: translateX(0);
}

/* 加载动画优化 */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.section-animate.visible {
    animation: fadeInUp 0.6s ease forwards;
}

/* 图片预览优化 */
#imagePreviewModal {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

#previewImage {
    animation: zoomIn 0.3s ease;
}

@keyframes zoomIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* 性能优化类 */
.reduce-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

.will-change {
    will-change: transform, opacity;
}

/* 滚动条美化 */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-color);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(
        to bottom,
        var(--primary-color),
        var(--secondary-color)
    );
    border-radius: 5px;
    border: 2px solid var(--bg-color);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(
        to bottom,
        var(--secondary-color),
        var(--primary-color)
    );
}

/* 视频播放器优化 */
.video-container {
    background: #000;
}

.demo-video {
    width: 100%;
    height: auto;
    display: block;
}

/* 深色模式优化 */
.dark-mode .card-animate {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.dark-mode .nav-link::after {
    background: rgba(255, 255, 255, 0.8);
}

/* 响应式优化 */
@media (max-width: 768px) {
    .nav-menu {
        flex-direction: column; gap: 15px; position: fixed; top: 70px; left: 0; width: 100%;
        background: var(--card-bg); padding: 20px 0; box-shadow: var(--card-shadow);
        transform: translateY(-150%); opacity: 0; pointer-events: none; transition: var(--transition);
    }
    .nav-menu.active { transform: translateY(0); opacity: 1; pointer-events: all; }
    .character-title { font-size: 28px; }
    .gallery-img { width: 220px; height: 300px; }
    .play-btn { width: 60px; height: 60px; font-size: 22px; }
    .typewriter { font-size: 24px; border-right: 1px solid var(--primary-color) !important; }
    .control-panel {
        min-width: 180px; padding: 15px;
        top: auto; bottom: 80px; right: 10px;
        transform: translateY(0);
    }
    .control-panel .color-picker-wrap { gap: 5px; }
    
    /* 移动端优化 */
    .typewriter {
        font-size: 1.5rem;
        animation-duration: 2.5s;
    }
    
    .text-gradient {
        background: var(--primary-color);
        -webkit-text-fill-color: var(--primary-color);
    }
    
    .card-animate {
        transform: none !important;
    }
}

/* ===== 二次元玻璃水滴 追加区 ===== */
body{
  background:linear-gradient(135deg,#d0c6ff 0%,#a8c0ff 50%,#c2e9fb 100%);
  background-attachment:fixed;
}
.dark-mode body{
  background:linear-gradient(135deg,#2d2b55 0%,#3a346e 50%,#1e1c33 100%);
}
body::before{ /* 轻度噪点 */
  content:"";position:fixed;inset:0;width:100%;height:100%;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".7" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".06"/></svg>');
  pointer-events:none;z-index:-1;
}

/* 玻璃卡片：直接利用你已有的变量，暗色自动适配 */
.card-animate,
.video-container,
.control-panel,
.gallery-container{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.25);
  box-shadow:0 8px 32px rgba(0,0,0,.1);
}
.dark-mode .card-animate,
.dark-mode .video-container,
.dark-mode .control-panel,
.dark-mode .gallery-container{
  background:rgba(0,0,0,0.15);
  border:1px solid rgba(255,255,255,0.15);
}

/* 水滴涟漪 */
.ripple{
  position:absolute;border-radius:50%;transform:scale(0);
  animation:rippleEffect .6s linear;
  background:radial-gradient(circle,rgba(255,255,255,0.6) 0%,rgba(255,255,255,0) 70%);
  pointer-events:none;
}
@keyframes rippleEffect{to{transform:scale(4);opacity:0}}

/* 导航常驻水滴 */
#navDrop{
  position:fixed;top:12px;left:12px;z-index:1000;pointer-events:none;
  filter:drop-shadow(0 0 6px var(--primary-color));
  animation:floatDrop 4s ease-in-out infinite;
}
@keyframes floatDrop{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-6px) rotate(4deg)}}

/* ===== 新增：兼容性修复 ===== */
/* Brave浏览器/Bing兼容性修复 */
@supports (-webkit-touch-callout: none) {
  /* iOS设备优化 */
  body {
    -webkit-overflow-scrolling: touch;
  }
}

/* 修复文字渲染 */
* {
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 修复动画性能 */
.card-animate, .gallery-img, .btn {
  will-change: transform, opacity;
  backface-visibility: hidden;
}

/* 修复滚动性能 */
body {
  overflow-x: hidden;
}

/* 修复图片显示 */
img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* 修复按钮点击状态 */
.btn:active {
  transform: scale(0.98);
}

/* 修复视频播放 */
video {
  object-fit: cover;
}

/* 修复深色模式切换 */
.dark-mode {
  transition: background-color 0.5s ease;
}

/* 移动端优化 - 减少动画复杂度 */
@media (max-width: 768px) {
  * {
    animation-duration: 0.5s !important;
    transition-duration: 0.3s !important;
  }
  
  /* 禁用复杂特效 */
  .particles-container {
    display: none;
  }
}

/* 打印优化 */
@media print {
  .control-panel,
  .back-to-top {
    display: none !important;
  }
}
  </style>
</head>
<body>
  <!-- 导航 -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><i class="fa fa-star"></i><span>卡提希娅的星光小站</span></div>
      <ul class="nav-menu">
        <li class="nav-item"><a href="#home" class="nav-link">首页</a></li>
        <li class="nav-item"><a href="#about" class="nav-link">角色设定</a></li>
        <li class="nav-item"><a href="#story" class="nav-link">故事背景</a></li>
        <li class="nav-item"><a href="#guide" class="nav-link">游戏攻略</a></li>
        <li class="nav-item"><a href="#gallery" class="nav-link">角色图库</a></li>
        <li class="nav-item"><a href="#demo" class="nav-link">实机演示</a></li>
      </ul>
      <div class="nav-toggle"><i class="fa fa-bars"></i></div>
    </div>
  </nav>

  <!-- 控制面板 -->
  <div class="control-panel">
    <h3><i class="fa fa-sliders"></i> 个性化设置</h3>
    <button class="control-btn" onclick="switchTheme('purple')"><i class="fa fa-palette"></i> 银紫色主题</button>
    <button class="control-btn" onclick="switchTheme('blue')"><i class="fa fa-snowflake-o"></i> 冰蓝色主题</button>
    <div class="color-picker-wrap">
      <label><i class="fa fa-eyedropper"></i> 自定义主色调：</label>
      <input type="color" id="customColorPicker" value="#8a5cf7">
      <button class="control-btn" onclick="applyCustomTheme()">应用</button>
    </div>
    <button class="control-btn" onclick="toggleDarkMode()"><i class="fa fa-moon"></i> 深色模式</button>
    <!-- 新增：特效开关 -->
    <button class="control-btn" id="effectsToggleBtn"><i class="fa fa-magic"></i> 关闭特效</button>
  </div>

  <!-- 回到顶部 -->
  <div class="back-to-top hidden"><i class="fa fa-arrow-up"></i></div>

  <!-- 首页 -->
  <section id="home" class="home-section section-animate">
    <div class="home-container">
      <img src="1.jpg" alt="卡提希娅头像" class="carterthyia-avatar">
      <h1 class="character-title typewriter">卡提希娅（芙露德莉丝）</h1>
      <p class="character-desc">于光影中守护的温柔使者 · 双形态战斗达人</p>
      <div class="home-btns">
        <a href="#gallery" class="btn">进入角色图库</a>
        <a href="#demo" class="btn btn-secondary">查看实机演示</a>
      </div>
    </div>
  </section>

  <!-- 角色设定 -->
  <section id="about" class="section-animate">
    <div class="section-header"><h2><i class="fa fa-user-circle"></i> 角色设定</h2><div class="section-divider"></div></div>
    <div class="card-animate">
      <div class="about-info"><span class="info-label">姓名：</span><span>卡提希娅（Carterthyia）</span></div>
      <div class="about-info"><span class="info-label">特质：</span><span>穿梭于光影之间，拥有温柔的力量，兼具顽皮与沉稳</span></div>
      <div class="about-info"><span class="info-label">形态：</span><span>迅刀形态（小卡） / 巨剑形态（大卡·芙露德莉丝）</span></div>
      <div class="about-info"><span class="info-label">称号：</span><span>芙露德莉斯（黎那汐塔圣女、岁主共鸣者）</span></div>
      <div class="about-info"><span class="info-label">核心技能：</span><span>气刃回旋、风轨突袭、终结技「苍穹崩裂」（真实伤害）</span></div>
    </div>
  </section>

  <!-- 故事背景 -->
  <section id="story" class="section-animate">
    <div class="section-header"><h2><i class="fa fa-book-open"></i> 角色故事背景</h2><div class="section-divider"></div></div>
    <div class="card-animate">
      <button id="storyToggle" class="btn" onclick="toggleStory()"><i class="fa fa-chevron-up"></i> 收起故事</button>
      <div id="storyContent" class="story-paragraph">
        <p class="story-title">【出身与命运的转折】</p>
        <p>卡提希娅原本是埃格拉小镇的普通少女，性格顽皮自由，热爱生活，喜欢喝酒与恶作剧，对小镇外的世界充满好奇。在一次小镇的岁主感恩礼祭典上，她意外扰乱了仪式流程，被隐海修会施以惩罚，却也正是这次"意外"，让她的命运与神明、鸣式紧密相连。</p>
        <p class="story-title">【芙露德莉丝的名号】</p>
        <p>在旅程中，她偶然与鸣式利维亚坦产生共鸣，获得了强大的力量，同时被赋予了"芙露德莉丝"的名号，被黎那汐塔的人们视为圣女和岁主共鸣者。</p>
        <p class="story-title">【双形态的秘密】</p>
        <p>作为首位常态与觉醒双形态角色，卡提希娅可以自由切换迅刀与巨剑形态。迅刀形态（小卡）保留了她原本的顽皮与敏捷，作战风格灵动飘逸；巨剑形态（大卡·芙露德莉丝）则展现出沉稳与威严，力量大幅提升。</p>
        <p class="story-title">【现况与未来】</p>
        <p>如今的卡提希娅，早已不是那个小镇上的顽皮少女，她在一次次战斗与抉择中成长，逐渐明白自己的使命。她一边守护着身边的人，一边探寻着鸣式与神明的秘密，未来的旅程仍充满未知，但她始终带着那份温柔与勇气，砥砺前行。</p>
      </div>
    </div>
  </section>

  <!-- 游戏攻略 -->
  <section id="guide" class="section-animate">
    <div class="section-header"><h2><i class="fa fa-gamepad"></i> 游戏攻略指南</h2><div class="section-divider"></div></div>
    <div class="card-animate">
      <div class="guide-tabs">
        <button class="tab-btn active" data-tab="core" onclick="switchGuideTab('core')">核心玩法</button>
        <button class="tab-btn" data-tab="weapon" onclick="switchGuideTab('weapon')">武器选择</button>
        <button class="tab-btn" data-tab="team" onclick="switchGuideTab('team')">配队推荐</button>
        <button class="tab-btn" data-tab="artifact" onclick="switchGuideTab('artifact')">声骸搭配</button>
      </div>
      <div id="coreContent" class="guide-content">
        <p class="story-title">一、定位与核心机制</p>
        <p>卡提希娅定位为气动主C，在V3.0版本中，逆境深塔榜单排名T0，冥歌海墟榜单排名T1，是当前版本异常体系中风蚀效应的核心输出角色。</p>
        <p class="story-title">二、输出循环技巧</p>
        <p>1. 常规循环：普攻连段 → 气刃回旋（叠加风蚀） → 风轨突袭（位移+补层） → 普攻收尾；</p>
        <p>2. 爆发循环：开启大招 → 切换巨剑形态 → 风蚀叠加至满层 → 释放「苍穹崩裂」 → 收割残血目标；</p>
      </div>
      <div id="weaponContent" class="guide-content hidden">
        <p class="story-title">一、首选武器（毕业专武）</p>
        <p>不屈命定之冠：卡提希娅专属武器，无下位替代，刚需抽取。该武器大幅提升风蚀效应伤害，同时增加自身生命值。</p>
        <p class="story-title">二、平民替代武器</p>
        <p>裁春、戍关迅刀·镇海、千古洑流等可作为过渡。</p>
      </div>
      <div id="teamContent" class="guide-content hidden">
        <p class="story-title">一、最优配队</p>
        <p>卡提希娅 + 夏空 + 千咲：风蚀体系拉满，夏空负责挂风蚀，千咲负责治疗与续航。</p>
        <p class="story-title">二、平民配队</p>
        <p>卡提希娅 + 气动主 + 散华 / 秧秧 + 白芷，低成本高效运转。</p>
      </div>
      <div id="artifactContent" class="guide-content hidden">
        <p class="story-title">一、毕业套装</p>
        <p>愿戴荣光之旅五件套：核心声骸套装，最优选择。</p>
        <p class="story-title">二、过渡套装</p>
        <p>风之低语四件套 + 生命增幅二件套，或异常猎手五件套。</p>
      </div>
    </div>
  </section>

  <!-- 角色图库 -->
  <section id="gallery" class="section-animate">
    <div class="section-header"><h2><i class="fa fa-images"></i> 角色图库</h2><div class="section-divider"></div></div>
    <div class="card-animate">
      <div class="gallery-tabs">
        <button class="gallery-tab active" data-type="all" onclick="filterGallery('all')">全部</button>
        <button class="gallery-tab" data-type="art" onclick="filterGallery('art')">立绘</button>
        <button class="gallery-tab" data-type="battle" onclick="filterGallery('battle')">战斗</button>
        <button class="gallery-tab" data-type="daily" onclick="filterGallery('daily')">日常</button>
        <button class="gallery-tab" data-type="beauty" onclick="filterGallery('beauty')">美图</button>
      </div>
      <div class="gallery-container">
        <img src="1.jpg" data-type="art" class="gallery-img" onclick="previewImage(this.src)" alt="立绘1">
        <img src="2.jpg" data-type="art" class="gallery-img" onclick="previewImage(this.src)" alt="立绘2">
        <img src="3.jpg" data-type="daily" class="gallery-img" onclick="previewImage(this.src)" alt="日常1">
        <img src="4.jpg" data-type="battle" class="gallery-img" onclick="previewImage(this.src)" alt="战斗1">
        <img src="5.jpg" data-type="battle" class="gallery-img" onclick="previewImage(this.src)" alt="战斗2">
        <img src="6.jpg" data-type="daily" class="gallery-img" onclick="previewImage(this.src)" alt="日常2">
        <img src="7.jpg" data-type="art" class="gallery-img" onclick="previewImage(this.src)" alt="立绘3">
        <img src="8.jpg" data-type="battle" class="gallery-img" onclick="previewImage(this.src)" alt="战斗3">
        <img src="123.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图1">
        <img src="17.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图2">
        <img src="master.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图3">
        <img src="167.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图4">
        <img src="134.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图5">
        <img src="32.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图6">
        <img src="kl.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图7">
        <img src="121.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图8">
        <img src="12112.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图9">
        <img src="1221.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图10">
        <img src="12115.jpg" data-type="beauty" class="gallery-img" onclick="previewImage(this.src)" alt="美图11">
      </div>
    </div>
  </section>

  <!-- 实机演示 -->
  <section id="demo" class="section-animate">
    <div class="section-header"><h2><i class="fa fa-film"></i> 实机演示视频</h2><div class="section-divider"></div></div>
    <div class="card-animate">
      <div class="gallery-tabs">
        <button class="gallery-tab active" onclick="switchVideo('small')">小卡（迅刀形态）</button>
        <button class="gallery-tab" onclick="switchVideo('big')">大卡（芙露德莉丝·巨剑形态）</button>
      </div>
      <div id="smallVideo" class="video-container">
        <div class="video-cover" onclick="playVideo('videoPlayer1',this)"><div class="play-btn"><i class="fa fa-play"></i></div></div>
        <video class="demo-video" id="videoPlayer1" controls muted playsinline poster="1.jpg"><source src="videos/111.mp4" type="video/mp4"></video>
      </div>
      <div id="bigVideo" class="video-container hidden">
        <div class="video-cover" onclick="playVideo('videoPlayer2',this)"><div class="play-btn"><i class="fa fa-play"></i></div></div>
        <video class="demo-video" id="videoPlayer2" controls muted playsinline poster="2.jpg"><source src="videos/12.mp4" type="video/mp4"></video>
      </div>
    </div>
  </section>

  <!-- 图片预览弹窗 -->
  <div id="imagePreviewModal" class="modal-hidden" onclick="closeImagePreview()">
    <div class="preview-content">
      <span class="preview-close">&times;</span>
      <img src="" alt="角色预览图" id="previewImage">
    </div>
  </div>

<!-- ================= 完整整合的JavaScript ================= -->
<script>
/* ------------ 站点配置 ------------ */
const siteConfig = {
  adminAccount: "admin",
  adminPassword: "carterthyia",
  siteName: "卡提希娅的星光小站",
  siteDomain: "www.carterthyia.com",
  siteDescription: "于光影中守护的温柔使者 · 双形态战斗达人卡提希娅专属站点",
  defaultTheme: "purple",
  defaultMode: "light",
  videoConfig: {
    smallCardVideo: "videos/111.mp4",
    bigCardVideo: "videos/12.mp4",
    videoPoster1: "1.jpg",
    videoPoster2: "2.jpg"
  },
  galleryCount: 8,
  galleryTypes: ["all", "art", "battle", "daily", "beauty"],
  // 新增：特效配置
  effectsConfig: {
    enableAdvancedEffects: true,
    maxParticles: 80,
    enableParallax: true,
    performanceMode: false
  }
};
window.siteConfig = siteConfig;

/* ------------ 全局变量 ------------ */
let currentTheme = window.siteConfig.defaultTheme;
let isDarkMode = window.siteConfig.defaultMode === 'dark';
let isStoryVisible = true;
let enhancedEffectsEnabled = window.siteConfig.effectsConfig.enableAdvancedEffects;
let enhancedEffectsManager = null;

/* ========== 您的原始功能 ========== */
/* ------------ 初始化 ------------ */
window.addEventListener('DOMContentLoaded', () => {
  // 初始化原有功能
  initAnimations();
  initNavbar();
  initBackToTop();
  initGalleryFilter();
  initGuideTab();
  initDefaultThemeAndMode();
  initCustomColorPicker();
  
  // 保留您的星空粒子效果
  initStarCanvas();
  initRipple();
  
  // 初始化优化版特效
  if (enhancedEffectsEnabled) {
    setTimeout(() => {
      initEnhancedEffects();
    }, 1000);
  }
  
  // 初始化特效控制按钮
  initEffectsControls();
});

/* ------------ 主题 & 深色模式 ------------ */
function initDefaultThemeAndMode() {
  const root = document.documentElement;
  const modeBtn = document.querySelector('.control-btn:nth-child(4) i');
  
  // 设置CSS变量
  if (!root.style.getPropertyValue('--primary-color-purple')) {
    root.style.setProperty('--primary-color-purple', '#8a5cf7');
    root.style.setProperty('--secondary-color-purple', '#a78bfa');
    root.style.setProperty('--bg-color-purple', '#f5f3ff');
    root.style.setProperty('--primary-color-blue', '#3b82f6');
    root.style.setProperty('--secondary-color-blue', '#60a5fa');
    root.style.setProperty('--bg-color-blue', '#eff6ff');
  }
  
  // 添加RGB变量用于特效
  if (!root.style.getPropertyValue('--primary-rgb')) {
    root.style.setProperty('--primary-rgb', '138, 92, 247');
  }
  
  switchTheme(currentTheme);
  
  if (isDarkMode) {
    document.body.classList.add('dark-mode');
    modeBtn?.classList.replace('fa-moon', 'fa-sun');
  } else {
    document.body.classList.remove('dark-mode');
    modeBtn?.classList.replace('fa-sun', 'fa-moon');
  }
  
  document.title = window.siteConfig?.siteName || "卡提希娅的星光小站";
}

function initCustomColorPicker() {
  const picker = document.getElementById('customColorPicker');
  if (!picker) return;
  
  const root = document.documentElement;
  const currentPrimary = root.style.getPropertyValue('--primary-color').replace('var(', '').replace(')', '').split('-color-')[1]
    ? (currentTheme === 'purple' ? '#8a5cf7' : '#3b82f6')
    : root.style.getPropertyValue('--primary-color');
  
  picker.value = currentPrimary;
}

function switchTheme(theme) {
  const root = document.documentElement;
  currentTheme = theme;
  
  if (theme === 'purple') {
    root.style.setProperty('--primary-color', 'var(--primary-color-purple)');
    root.style.setProperty('--secondary-color', 'var(--secondary-color-purple)');
    root.style.setProperty('--bg-color', 'var(--bg-color-purple)');
    root.style.setProperty('--primary-rgb', '138, 92, 247');
  } else if (theme === 'blue') {
    root.style.setProperty('--primary-color', 'var(--primary-color-blue)');
    root.style.setProperty('--secondary-color', 'var(--secondary-color-blue)');
    root.style.setProperty('--bg-color', 'var(--bg-color-blue)');
    root.style.setProperty('--primary-rgb', '59, 130, 246');
  }
}

function applyCustomTheme() {
  const picker = document.getElementById('customColorPicker');
  if (!picker) return;
  
  const customColor = picker.value;
  const root = document.documentElement;
  const lightColor = lightenColor(customColor, 20);
  
  // 解析RGB值
  const rgb = hexToRgb(customColor);
  if (rgb) {
    root.style.setProperty('--primary-rgb', `${rgb.r}, ${rgb.g}, ${rgb.b}`);
  }
  
  root.style.setProperty('--primary-color', customColor);
  root.style.setProperty('--secondary-color', lightColor);
  currentTheme = 'custom';
}

function hexToRgb(hex) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

function lightenColor(color, percent) {
  const num = parseInt(color.replace("#", ""), 16);
  const amt = Math.round(2.55 * percent);
  const R = Math.min(255, (num >> 16) + amt);
  const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
  const B = Math.min(255, (num & 0x0000FF) + amt);
  return "#" + (0x1000000 + R*0x10000 + G*0x100 + B).toString(16).slice(1);
}

function toggleDarkMode() {
  isDarkMode = !isDarkMode;
  document.body.classList.toggle('dark-mode');
  const modeBtn = document.querySelector('.control-btn:nth-child(4) i');
  modeBtn?.classList.toggle('fa-moon');
  modeBtn?.classList.toggle('fa-sun');
}

/* ------------ 滚动动效 ------------ */
function initAnimations() {
  window.addEventListener('scroll', () => {
    document.querySelectorAll('.section-animate').forEach(el => {
      if (el.getBoundingClientRect().top < window.innerHeight * 0.8) el.classList.add('visible');
    });
    document.querySelectorAll('.card-animate').forEach(el => {
      if (el.getBoundingClientRect().top < window.innerHeight * 0.9) el.classList.add('visible');
    });
  });
  window.dispatchEvent(new Event('scroll'));
}

/* ------------ 导航 ------------ */
function initNavbar() {
  const navbar = document.querySelector('.navbar');
  const navToggle = document.querySelector('.nav-toggle');
  const navMenu = document.querySelector('.nav-menu');
  
  window.addEventListener('scroll', () => window.scrollY > 50 ? navbar.classList.add('scrolled') : navbar.classList.remove('scrolled'));
  
  navToggle?.addEventListener('click', () => {
    navMenu?.classList.toggle('active');
    const icon = navToggle.querySelector('i');
    navMenu?.classList.contains('active') ? icon.classList.replace('fa-bars', 'fa-times') : icon.classList.replace('fa-times', 'fa-bars');
  });
}

/* ------------ 回到顶部 ------------ */
function initBackToTop() {
  const btn = document.querySelector('.back-to-top');
  window.addEventListener('scroll', () => window.scrollY > 300 ? btn?.classList.remove('hidden') : btn?.classList.add('hidden'));
  btn?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
}

/* ------------ 图库筛选 ------------ */
function initGalleryFilter() {
  document.querySelectorAll('.gallery-tab').forEach(tab => {
    tab.addEventListener('click', function () {
      document.querySelectorAll('.gallery-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const type = this.dataset.type;
      
      document.querySelectorAll('.gallery-img').forEach(img => {
        if (type === 'all' || img.dataset.type === type) {
          img.style.display = 'block';
          setTimeout(() => img.style.opacity = '1', 100);
        } else {
          img.style.opacity = '0';
          setTimeout(() => img.style.display = 'none', 300);
        }
      });
    });
  });
}

function filterGallery(type) {
  document.querySelectorAll('.gallery-tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.gallery-tab[data-type="${type}"]`)?.classList.add('active');
  
  document.querySelectorAll('.gallery-img').forEach(img => {
    if (type === 'all' || img.dataset.type === type) {
      img.style.display = 'block';
      setTimeout(() => img.style.opacity = '1', 100);
    } else {
      img.style.opacity = '0';
      setTimeout(() => img.style.display = 'none', 300);
    }
  });
}

/* ------------ 攻略标签 ------------ */
function initGuideTab() {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.guide-content').forEach(c => c.classList.add('hidden'));
  document.querySelector('.tab-btn[data-tab="core"]')?.classList.add('active');
  document.getElementById('coreContent')?.classList.remove('hidden');
}

function switchGuideTab(tab) {
  document.querySelectorAll('.guide-content').forEach(c => c.classList.add('hidden'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`${tab}Content`)?.classList.remove('hidden');
  document.querySelector(`.tab-btn[data-tab="${tab}"]`)?.classList.add('active');
}

/* ------------ 故事展开/收起 ------------ */
function toggleStory() {
  const content = document.getElementById('storyContent');
  const toggle = document.getElementById('storyToggle');
  isStoryVisible = !isStoryVisible;
  
  if (isStoryVisible) {
    content.style.display = 'block';
    toggle.innerHTML = '<i class="fa fa-chevron-up"></i> 收起故事';
  } else {
    content.style.display = 'none';
    toggle.innerHTML = '<i class="fa fa-chevron-down"></i> 展开故事';
  }
}

/* ------------ 图片预览 ------------ */
function previewImage(src) {
  const modal = document.getElementById('imagePreviewModal');
  const img = document.getElementById('previewImage');
  img.src = src;
  modal.classList.remove('modal-hidden');
  document.body.style.overflow = 'hidden';
}

function closeImagePreview() {
  const modal = document.getElementById('imagePreviewModal');
  modal.classList.add('modal-hidden');
  document.body.style.overflow = 'auto';
}

/* ------------ 视频播放 ------------ */
function playVideo(playerId, coverElement) {
  const videoElement = document.getElementById(playerId);
  if (!videoElement || !coverElement) return;
  
  const playPromise = videoElement.play();
  if (playPromise) {
    playPromise.then(() => coverElement.style.display = 'none')
      .catch(() => {
        coverElement.style.display = 'none';
        // 静默失败，不显示警告
      });
  } else {
    coverElement.style.display = 'none';
  }
  
  videoElement.addEventListener('ended', () => {
    videoElement.currentTime = 0;
    coverElement.style.display = 'flex';
  });
}

function switchVideo(type) {
  document.querySelectorAll('.gallery-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.gallery-tab[onclick*="${type}"]`)?.classList.add('active');
  
  if (type === 'small') {
    document.getElementById('smallVideo').classList.remove('hidden');
    document.getElementById('bigVideo').classList.add('hidden');
  } else if (type === 'big') {
    document.getElementById('smallVideo').classList.add('hidden');
    document.getElementById('bigVideo').classList.remove('hidden');
  }
}

/* ========== 您的原始特效 ========== */
/* ------------ 星空粒子 ------------ */
let starCanvas, starCtx, particles = [], mx = 0, my = 0;

function initStarCanvas() {
  starCanvas = document.createElement('canvas');
  starCanvas.id = 'starCanvas';
  starCanvas.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  `;
  document.body.appendChild(starCanvas);
  starCtx = starCanvas.getContext('2d');
  
  resizeStar();
  window.addEventListener('resize', resizeStar);
  window.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
  
  animateStars();
}

function resizeStar() {
  starCanvas.width = window.innerWidth;
  starCanvas.height = window.innerHeight;
}

class Particle {
  constructor() {
    this.x = Math.random() * starCanvas.width;
    this.y = starCanvas.height + 20;
    this.vy = -(1 + Math.random() * 2);
    this.vx = (Math.random() - 0.5) * 0.6;
    this.r = Math.random() * 1.5 + 0.5;
  }
  
  update() {
    this.y += this.vy;
    this.x += this.vx;
    const dx = this.x - mx, dy = this.y - my, d = Math.hypot(dx, dy);
    
    if (d < 120) {
      this.x += dx / d * 1.2;
      this.y += dy / d * 1.2;
    }
    
    if (this.y < -20) this.y = starCanvas.height + 20;
  }
  
  draw() {
    starCtx.beginPath();
    const g = starCtx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.r);
    g.addColorStop(0, 'rgba(255,255,255,1)');
    g.addColorStop(1, 'rgba(180,160,255,0)');
    starCtx.fillStyle = g;
    starCtx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    starCtx.fill();
  }
}

function animateStars() {
  starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
  
  if (particles.length < (window.innerWidth < 768 ? 30 : 60)) {
    particles.push(new Particle());
  }
  
  particles = particles.filter(p => {
    p.update();
    p.draw();
    return p.y > -30;
  });
  
  requestAnimationFrame(animateStars);
}

/* ------------ 水滴涟漪 ------------ */
function initRipple() {
  document.body.addEventListener('click', function (e) {
    const card = e.target.closest('.card-animate,.video-container,.gallery-img,.btn');
    if (!card) return;
    
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    const ripple = document.createElement('span');
    ripple.className = 'ripple';
    ripple.style.width = ripple.style.height = '20px';
    ripple.style.left = x - 10 + 'px';
    ripple.style.top = y - 10 + 'px';
    
    card.style.position = 'relative';
    card.style.overflow = 'hidden';
    card.appendChild(ripple);
    
    setTimeout(() => ripple.remove(), 600);
  });
}

/* ========== 我的优化特效 ========== */
/* ------------ 高级特效系统 ------------ */
function initEnhancedEffects() {
  if (window.enhancedEffectsManager) return;
  
  window.enhancedEffectsManager = {
    effects: [],
    enabled: true,
    isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
    
    init() {
      // 1. 3D视差效果（仅桌面）
      if (!this.isMobile) {
        this.initParallax3D();
      }
      
      // 2. 粒子系统
      this.initParticleSystem();
      
      // 3. 文字流光
      this.initTextEffects();
      
      // 4. 鼠标轨迹
      this.initMouseTrail();
      
      // 5. 灯光效果
      this.initLightingEffects();
      
      console.log('高级特效系统已加载 - 稳定模式');
    },
    
    initParallax3D() {
      const cards = document.querySelectorAll('.card-animate, .video-container, .gallery-img');
      
      document.addEventListener('mousemove', (e) => {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        const mouseX = e.clientX;
        const mouseY = e.clientY;
        
        const rotateY = (mouseX - centerX) / centerX * 3; // 减少旋转幅度
        const rotateX = (centerY - mouseY) / centerY * 3;
        
        cards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const cardCenterX = rect.left + rect.width / 2;
          const cardCenterY = rect.top + rect.height / 2;
          
          const distanceX = Math.abs(mouseX - cardCenterX);
          const distanceY = Math.abs(mouseY - cardCenterY);
          const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);
          
          // 只有鼠标靠近卡片时才应用3D效果
          if (distance < 300) {
            const intensity = 1 - (distance / 300);
            card.style.transform = `
              perspective(1000px)
              rotateY(${rotateY * intensity}deg)
              rotateX(${rotateX * intensity}deg)
              scale(${1 + intensity * 0.02})
            `;
            card.style.transition = 'transform 0.3s ease-out';
          }
        });
      });
      
      // 鼠标离开时恢复
      document.addEventListener('mouseleave', () => {
        cards.forEach(card => {
          card.style.transform = 'perspective(1000px) rotateY(0deg) rotateX(0deg) scale(1)';
          card.style.transition = 'transform 0.5s ease-out';
        });
      });
    },
    
    initParticleSystem() {
      if (this.isMobile) return; // 移动端不显示粒子
      
      const container = document.querySelector('.home-section');
      if (!container) return;
      
      // 创建粒子容器
      const particlesContainer = document.createElement('div');
      particlesContainer.className = 'particles-container';
      particlesContainer.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
      `;
      container.style.position = 'relative';
      container.appendChild(particlesContainer);
      
      // 创建少量粒子
      const particleCount = this.isMobile ? 10 : 20;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // 随机属性
        const size = Math.random() * 3 + 1;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        
        particle.style.cssText = `
          position: absolute;
          width: ${size}px;
          height: ${size}px;
          background: var(--primary-color);
          border-radius: 50%;
          left: ${posX}%;
          top: ${posY}%;
          opacity: ${Math.random() * 0.2 + 0.05};
          animation: floatParticle ${duration}s linear infinite;
          animation-delay: ${delay}s;
        `;
        
        particlesContainer.appendChild(particle);
      }
      
      // 添加CSS动画
      const style = document.createElement('style');
      style.textContent = `
        @keyframes floatParticle {
          0%, 100% {
            transform: translate(0, 0) rotate(0deg);
            opacity: 0.1;
          }
          25% {
            transform: translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px) rotate(90deg);
            opacity: 0.2;
          }
          50% {
            transform: translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px) rotate(180deg);
            opacity: 0.15;
          }
          75% {
            transform: translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px) rotate(270deg);
            opacity: 0.2;
          }
        }
      `;
      document.head.appendChild(style);
      
      this.effects.push({ type: 'particles', container: particlesContainer });
    },
    
    initTextEffects() {
      // 为标题添加渐变文字
      const headings = document.querySelectorAll('h1, h2, h3');
      headings.forEach(heading => {
        if (!heading.classList.contains('typewriter')) {
          heading.classList.add('text-gradient');
        }
      });
      
      // 为故事标题添加特殊效果
      const storyTitles = document.querySelectorAll('.story-title');
      storyTitles.forEach(title => {
        title.addEventListener('mouseenter', () => {
          title.style.textShadow = '0 0 10px var(--primary-color)';
        });
        
        title.addEventListener('mouseleave', () => {
          title.style.textShadow = 'none';
        });
      });
    },
    
    initMouseTrail() {
      const trail = [];
      const maxTrail = 10;
      
      document.addEventListener('mousemove', (e) => {
        const trailEl = document.createElement('div');
        trailEl.className = 'mouse-trail';
        trailEl.style.cssText = `
          position: fixed;
          width: 6px;
          height: 6px;
          background: var(--primary-color);
          border-radius: 50%;
          pointer-events: none;
          z-index: 9999;
          left: ${e.clientX - 3}px;
          top: ${e.clientY - 3}px;
          opacity: 0.7;
          transform: scale(1);
          transition: all 0.3s ease-out;
        `;
        
        document.body.appendChild(trailEl);
        trail.push(trailEl);
        
        // 清理旧轨迹
        if (trail.length > maxTrail) {
          const old = trail.shift();
          if (old && old.parentNode) {
            old.parentNode.removeChild(old);
          }
        }
        
        // 动画效果
        setTimeout(() => {
          trailEl.style.opacity = '0';
          trailEl.style.transform = 'scale(0)';
        }, 50);
        
        setTimeout(() => {
          if (trailEl.parentNode) {
            trailEl.parentNode.removeChild(trailEl);
          }
        }, 300);
      });
    },
    
    initLightingEffects() {
      // 聚光灯效果
      const spotlight = document.createElement('div');
      spotlight.id = 'dynamic-spotlight';
      spotlight.style.cssText = `
        position: fixed;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 30%,
          transparent 70%
        );
        pointer-events: none;
        z-index: 3;
        opacity: 0;
        transition: opacity 0.3s ease;
      `;
      document.body.appendChild(spotlight);
      
      document.addEventListener('mousemove', (e) => {
        spotlight.style.left = `${e.clientX - 75}px`;
        spotlight.style.top = `${e.clientY - 75}px`;
        spotlight.style.opacity = '0.5';
      });
      
      document.addEventListener('mouseleave', () => {
        spotlight.style.opacity = '0';
      });
      
      this.effects.push({ type: 'lighting', element: spotlight });
    },
    
    toggleAllEffects() {
      this.enabled = !this.enabled;
      
      const effects = [
        '.particles-container',
        '#dynamic-spotlight',
        '.mouse-trail'
      ];
      
      effects.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(el => {
          el.style.display = this.enabled ? 'block' : 'none';
        });
      });
      
      // 更新按钮文本
      const btn = document.getElementById('effectsToggleBtn');
      if (btn) {
        const icon = btn.querySelector('i');
        if (this.enabled) {
          icon.className = 'fa fa-magic';
          btn.innerHTML = '<i class="fa fa-magic"></i> 关闭特效';
        } else {
          icon.className = 'fa fa-ban';
          btn.innerHTML = '<i class="fa fa-ban"></i> 开启特效';
        }
      }
      
      return this.enabled;
    }
  };
  
  window.enhancedEffectsManager.init();
  enhancedEffectsManager = window.enhancedEffectsManager;
}

/* ------------ 特效控制 ------------ */
function initEffectsControls() {
  const toggleBtn = document.getElementById('effectsToggleBtn');
  
  if (toggleBtn) {
    toggleBtn.onclick = () => {
      enhancedEffectsEnabled = !enhancedEffectsEnabled;
      
      if (enhancedEffectsEnabled && !enhancedEffectsManager) {
        initEnhancedEffects();
      } else if (enhancedEffectsManager) {
        enhancedEffectsManager.toggleAllEffects();
      }
    };
  }
}

/* ------------ 页面加载完成后优化 ------------ */
window.addEventListener('load', () => {
  // 添加CSS动画
  const style = document.createElement('style');
  style.textContent = `
    /* 新增动画 */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* 图片加载动画 */
    .gallery-img {
      animation: fadeIn 0.5s ease;
    }
    
    /* 按钮悬停效果 */
    .btn:hover {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { 
        box-shadow: 0 0 10px var(--primary-color);
      }
      50% { 
        box-shadow: 0 0 20px var(--secondary-color);
      }
    }
  `;
  document.head.appendChild(style);
  
  // 性能优化
  optimizePerformance();
});

function optimizePerformance() {
  // 减少过渡动画对浏览器性能的影响
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
  
  if (prefersReducedMotion.matches) {
    document.body.classList.add('reduce-motion');
  }
  
  // 监听性能偏好
  prefersReducedMotion.addEventListener('change', () => {
    if (prefersReducedMotion.matches) {
      document.body.classList.add('reduce-motion');
    } else {
      document.body.classList.remove('reduce-motion');
    }
  });
  
  // 优化滚动性能
  window.addEventListener('scroll', () => {
    requestAnimationFrame(() => {
      // 滚动优化逻辑
    });
  }, { passive: true });
}
</script>
</body>
</html>